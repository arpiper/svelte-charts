<div id="{{ toolTipId }}" class="tooltip-container">
</div>

<script>
var d3 = require("d3")
var $ = require("jquery")

export default {
  data () {
    return {
      chartData: {},
    }
  },
  computed: {
    toolTipId (chartData) {
      return `${chartData.selector}-tooltip`
    }
  },
  methods: {
    addToolTip () {
      let data = this.get("chartData")
      let svg = d3.select(`#${data.selector}`).select("g")
      let tip = svg.append("g")
        .append("foreignObject")
          .attr("class", "tooltip")

      let tipbars = svg.append("g").selectAll("rect").data(data.dataset.x)
        .enter().append("rect")
          .attr("class", "tooltip-bar")
          .attr("width", 20)
          .attr("x", (d) => this.getXCoords(data.scales.x, d) - 10)
          .attr("height", data.size.adj_height)
          .style("opacity", 0)
          .on("mouseover", (d,i,n) => {
            let x = this.getXCoords(data.scales.x, d)
            let y = this.getYCoords(data.scales.y, data.dataset.y[i])
            let e = document.createElement("span")
            e.innerText = `${d}:${data.dataset.y[i]}`
            e.id = `tooltip-data-${i}`
            e.setAttribute("class", "tooltip")
            e.style.backgroundColor = "rgba(0,0,0,0.8)"
            e.style.color = "white"
            e.style.fontSize = "10px"
            e.style.padding = "2px 5px"
            e.style.visibility = "hidden"
            tip.html(e.outerHTML)
            e = document.getElementById(`tooltip-data-${i}`)
            tip.attr("x", x - (e.offsetWidth / 2))
              .attr("y", y - (e.offsetHeight * 2))
              .attr("opacity", 1)
              .attr("width", e.offsetWidth)
              .attr("height", e.offsetHeight)
            e.style.visibility = "visible"
          })
          .on("mouseout", (d,i,n) => {
            n[i].style['opacity'] = 0
            tip.attr('opacity', 0)
          })
      tip.on("mouseover", () => tip.attr("opacity", 1))
        .on("mouseout", () => tip.attr("opacity", 0))
        
      return tip
    },
    getXCoords (xfunc, val) {
      let x = xfunc(val)
      if (xfunc.step) {
        x += xfunc.step() / 2
      }
      return x
    },
    getYCoords (yfunc, val) {
      let y = yfunc(val)
      if (yfunc.step) {
        y += yfunc.step() / 2
      }
      return y
    }
  },
  oncreate () {
    let d = this.get("chartData")
    this.addToolTip()
  }
}
</script>

<style>
.tooltip-container {
  position: relative;
}
.tooltip {
  position: absolute;
  z-index: 100;
  background-color: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 10px;
}
/*
 * little triangle 
 */
.tooltip:after {
  display: block;
  content: "";
  position: absolute;
  bottom: -10px;
  left: calc(50% - 10px);
  border-width: 10px 10px 0;
  border-style: solid;
  border-color: rgba(0, 0, 0, 0.8) transparent;
  width: 0;
}
.tooltip-bar {
  fill-opacity: 0.25;
  stroke-width: 2px;
  stroke: black;
  z-index: 1000;
}
</style>
