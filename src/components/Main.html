<div class="svelte-chart-container">
  {{#if type === "line"}}
  <LineChart
    size="{{ sizeProp }}"
    title="{{ title }}"
    dataset="{{ dataset }}"
    scales="{{ setScales }}"
    bind:selector="selector">
    <svg id="{{ selector }}" class="line-chart-inject"></svg>
  </LineChart>
  {{elseif type === "bar"}}
  <BarChart
    size="{{ sizeProp }}"
    title="{{ title }}"
    dataset="{{ dataset }}"
    scales="{{ setScales }}"
    bind:selector="selector">
    <svg id="{{ selector }}" class="bar-chart-inject"></svg>
  </BarChart>
  {{/if}}
</div>

<script>
var d3 = require("d3")
var $ = require("jquery")
import LineChart from "./LineChart.html"
import BarChart from "./BarChart.html"

export default {
  data () {
    return {
      selector: "",
      type: "line",
      title: "Chart Title",
      size: {
        height: 300,
        width: 600,
        margin: 20 
      },
      dataset: {},
      scales: undefined,
      xyaxis: undefined,
    }
  },
  computed: {
    sizeProp (size) {
      size.adj_height = size.height - (2 * size.margin)
      size.adj_width = size.width - (2 * size.margin)
      return size
    },
    setScales (dataset, scales, sizeProp) {
      let xdomain, ydomain, x, y
      if (typeof(dataset.x[0]) === "string") {
        xdomain = dataset.x
        x = d3.scaleBand()
      } else if (typeof(dataset.x[0]) === "number") {
        xdomain = [0, (scales) ? scales.x : d3.max(dataset.x) * 1.334]
        x = d3.scaleLinear()
      }
      if (typeof(dataset.y[0]) === "string") {
        ydomain = dataset.y
        y = d3.scaleBand()
      } else if (typeof(dataset.y[0]) === "number") {
        ydomain = [0, (scales) ? scales.y : d3.max(dataset.y) * 1.334]
        y = d3.scaleLinear()
      }
      y = y.domain(ydomain)
          .range([sizeProp.adj_height, 0])
      x = x.domain(xdomain)
          .range([0, sizeProp.adj_width])
      return {x: x, y: y}
    },
  },
  methods: {
    setSvg () {
      let size = this.get("size")
      let id = this.get("selector")
      let svg = d3.select(`#${id}`)
          .attr("height", size.height)
          .attr("width", size.width)
      this.set({svg: svg})
    },
  },
  oncreate () {
    this.setSvg()
  },
  components: {
    LineChart,
    BarChart
  }
}
</script>


<style scoped>
.svelte-chart-container {
  font-family: 'Avenir', Helvetica, Arial, sans-serif;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
